{% extends 'base.html' %}
{% block main %}
<h1>Расписание</h1>
<form name="publish">
 <input type="text" name="nameField" placeholder="ФИО ученика" id="nameField">
 <input type="submit" value="Получить расписание" id="submitButton"><br>
</form>
<script>let name = []
function handleSubmit(event) {
  event.preventDefault();
  const data = new FormData(event.target);
  const value = data.get('nameField');
  name.push(value)
  alert(name)
}
const form = document.querySelector('form');
form.addEventListener('submit', handleSubmit);


function request(studentname){
    let xhr = new XMLHttpRequest();
    let url = BASE_PATH + '/get-weekly-timetable-for-student/' + studentname;

    xhr.open('GET', url);

    xhr.send();

    xhr.onload = ()=>{
        if(xhr.status == 200){
            let response = JSON.parse(xhr.response);
            let table = document.getElementById('timetablesTable');

            response.forEach(element => {
                let row = table.insertRow(1);
                let id = row.insertCell(0);
                let day_of_the_week = row.insertCell(1);
                let group_id = row.insertCell(2);
                let subject_id = row.insertCell(3);
                let room_id = row.insertCell(4);
                let start_time = row.insertCell(5);
                let end_time = row.insertCell(6);
                let timetable_id = row.insertCell(7);

                id.innerHTML = element['object_id'];
                day_of_the_week.innerHTML = element['day_of_the_week'];
                group_id.innerHTML = element['group_id'];
                subject_id.innerHTML = element['subject_id'];
                room_id.innerHTML = element['room_id'];
                start_time.innerHTML = element['start_time'];
                end_time.innerHTML = element['end_time'];
                timetable_id.innerHTML = element['timetable_id'];
            });
        }
    }
}

if(name._length == 1) {request(name[0])}
</script>
<div id="timetable">
<table id="timetablesTable" border=1 frame=void>
    <thead>
        <tr>
            <th>ID</th>
            <th>День недели</th>
            <th>ID классов</th>
            <th>ID предметов</th>
            <th>ID локации</th>
            <th>Начало</th>
            <th>Конец</th>
            <th>ID года</th>
        </tr>
    </thead>
</table>

</div>
{% endblock %}

{% block footer %}
<nav>
    <a href="/students">Список учеников</a>
    <a href="/groups">Список классов</a>
    <a href="/lessons">Список уроков</a>
    <a href="/teachers">Список учителей</a>
    <a href="/subjects">Список предметов</a>
    <a href="/timetable">Расписание</a>
</nav>
{% endblock %}

{% block script %}
<script type="module" src="static/js/week_timetable.js"></script>

{% endblock %}